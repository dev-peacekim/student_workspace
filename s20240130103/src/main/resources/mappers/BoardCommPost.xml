<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.blackberry.s20240130103.BoardStudyMapper">
	<select id="ykmGetPostList" resultType="YkmBoardComm">
		SELECT B.CBOARD_NO, B.CBOARD_TITLE, B.CBOARD_VIEWCNT, B.CBOARD_DATE, R.REPLYCNT, U.USER_ID
		FROM BOARD_COMM B
		LEFT JOIN ( SELECT CBOARD_NO, 
					COUNT(*) AS REPLYCNT 
					FROM BOARD_COMM_REPLY
					GROUP BY CBOARD_NO
					) R ON B.CBOARD_NO = R.CBOARD_NO
		LEFT JOIN USERS U ON U.USER_NO = B.USER_NO
		WHERE B.COMM_BIG=200 AND B.COMM_MID = 20
		ORDER BY B.CBOARD_NO DESC
	</select>
	
	<select id="ykmGetPost" resultType="YkmBoardComm" parameterType="int">
		SELECT B.*, U.USER_ID 
		FROM BOARD_COMM B,USERS U
		WHERE B.CBOARD_NO = #{cboard_no}
		AND B.USER_NO = U.USER_NO
	</select>
	
	<insert id="ykmWritePost" parameterType="YkmBoardComm">
		INSERT INTO BOARD_COMM (CBOARD_NO,
								CBOARD_TITLE,
								CBOARD_CONTENT,
								CBOARD_VIEWCNT,
								CBOARD_DATE,
								USER_NO,
								CBOARD_DELETE_CHK,
								COMM_BIG,
								COMM_MID,
								COMM_BIG2,
								COMM_MID2,
								COMM_UPDATE_DATE)
		VALUES (SEQ_BOARD_COMM.NEXTVAL, #{cboard_title}, #{cboard_content}, 0, sysdate, #{user_no}, 0, 200, 20, 400, 10, sysdate)
	</insert>
	
	<update id="ykmUpdatePost" parameterType="YkmBoardComm">
		UPDATE BOARD_COMM
		SET CBOARD_TITLE = #{cboard_title}, CBOARD_CONTENT = #{cboard_content}, COMM_UPDATE_DATE = sysdate
		WHERE CBOARD_NO = #{cboard_no}
	</update>
	
	<delete id="ykmDeletePost" parameterType="int">
		DELETE
		FROM BOARD_COMM
		WHERE CBOARD_NO = #{cboard_no}
	</delete>
 
</mapper>