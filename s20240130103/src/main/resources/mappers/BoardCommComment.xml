<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.blackberry.s20240130103.BoardPostMapper">
	<select id="ykmGetCommentList" resultType="YkmBoardCommReply" parameterType="int">
		SELECT 
			BCR.CREPLY_NO, BCR.CREPLY_CONTENT, BCR.COMM_UPDATE_DATE, BCR.CBOARD_NO, BCR.CREPLY_DELETE_CHK, 
			BC.COMM_BIG, BC.COMM_MID, 
			U.USER_ID, U.USER_NO, U.USER_NIC
		FROM BOARD_COMM_REPLY BCR
		JOIN USERS U ON BCR.USER_NO = U.USER_NO
		JOIN BOARD_COMM BC ON BCR.CBOARD_NO = BC.CBOARD_NO
		WHERE BC.COMM_BIG = 200 AND BC.COMM_MID = 20
		AND BCR.CBOARD_NO = #{cboard_no}
		AND BCR.CREPLY_DELETE_CHK = 0
		ORDER BY BCR.CREPLY_DATE ASC
	</select>
	
	<insert id="ykmWriteComment" parameterType="YkmBoardCommReply">
		INSERT INTO BOARD_COMM_REPLY (CREPLY_NO, CREPLY_CONTENT, CREPLY_DATE, CREPLY_GROUP, CREPLY_LEVEL, CREPLY_INDENT, CBOARD_NO, USER_NO, CREPLY_DELETE_CHK, COMM_UPDATE_DATE)
		VALUES (SEQ_BOARD_COMM_REPLY.NEXTVAL, #{creply_content}, sysdate, 1, 1, 1, #{cboard_no}, #{user_no}, 0, sysdate)
	</insert>

	<update id="ykmDeleteComment" parameterType="int">
		UPDATE BOARD_COMM_REPLY
		SET CREPLY_DELETE_CHK = 1, COMM_UPDATE_DATE = sysdate
		WHERE CREPLY_NO = #{creply_no}
	</update>
	
	<update id="ykmUpdateComment" parameterType="YkmBoardCommReply">
		UPDATE BOARD_COMM_REPLY
		SET CREPLY_CONTENT = #{creply_content}, COMM_UPDATE_DATE = sysdate
		WHERE creply_no = #{creply_no}
	</update>

	<select id="ykmCountComment" resultType="int" parameterType="int">
		SELECT COUNT(BCR.CREPLY_NO) countComment, BCR.CBOARD_NO
		FROM BOARD_COMM_REPLY BCR
		JOIN BOARD_COMM B ON BCR.CBOARD_NO = B.CBOARD_NO
		WHERE BCR.CBOARD_NO = #{cboard_no}
		AND B.COMM_BIG = 200 
		AND B.COMM_MID = 20
		AND BCR.CREPLY_DELETE_CHK =0
		GROUP BY BCR.CBOARD_NO
	</select>  

</mapper>